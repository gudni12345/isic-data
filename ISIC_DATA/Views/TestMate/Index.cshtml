@using BootstrapSupport
@model ISIC_DATA.Models.TestMateViewModel

@{
    Layout = "~/Views/Shared/_BootstrapLayout.Home.cshtml";
    ViewBag.Title = "Test mate";
}

@Styles.Render("~/Content/typeahead.js-bootstrap.css")

<div class="container-fluid containerLeftMargin dog-details">

@using (Html.BeginForm(new { @class = "form-horizontal span9" }))
{
    
    <fieldset>
           
        <legend>Test mate - Get the inbreeding coefficent of a potential future puppy&nbsp;&nbsp;
            @Html.ActionLink("More Info", "Info", "TestMate", null, new { id = "info", style = "margin-bottom: 8px", @class = "btn btn-success" })
        </legend>

        <div id='dialogDiv' class='modal hide fade in'>
            <div id='dialogContent'></div>
        </div>
        <div class="editor-field">
            <label>Father:</label>
            <div class="CustomTemplate">                
            @Html.TextBoxFor(model => model.Father.Reg, new { placeholder="Father's Reg", id="typeaheadFather" })
            @Html.HiddenFor(model => model.Father.Id, new { @id = "returnFatherId" })                     
            @Html.TextBoxFor(model => model.Father.Name, new { id="fatherName", disabled = "disabled"  }) 
            </div>
        </div>
        <div class="editor-field">
            <label>Mother:</label>
            <div class="CustomTemplate">                
            @Html.TextBoxFor(model => model.Mother.Reg, new {placeholder="Mother's Reg", id="typeaheadMother" })
            @Html.HiddenFor(model => model.Mother.Id, new { @id = "returnMotherId" })     
            @Html.TextBoxFor(model => model.Mother.Name, new { id = "motherName", disabled = "disabled" })    
            </div>  
        </div>            
                


    </fieldset>

    if (ViewBag.Result != null)
    {
        <strong>Inbreeding coefficient = @ViewBag.Result %</strong><br />
        if (ViewBag.Ancestor != 1 && ViewBag.Ancestor != 0){<strong>Common ancestor: @ViewBag.AncestorName</strong>}
    }
    
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Check</button>
        @Html.ActionLink("Cancel", "../Home/Index", null, new { @class = "btn " })
    </div>
   
} <!-- end form -->

<div class="tab-pane active" id="pedigree">      
         
         
         <table  BORDER="2" CELLSPACING=0 CELLPADDING=4 COLS=5 WIDTH="100%" BGCOLOR="#FFFFFF"">
           <thead>
             <tr>
                <th style="width:50px;table-layout:fixed">Parents</th>
                <th style="width:100px;table-layout:fixed">Grandparents</th>
                <th style="width:100px;table-layout:fixed">Great Grandparents</th>
                <th style="width:100px;table-layout:fixed">Great Great Grandparents</th>
             </tr>
              </thead>
                @*Fathers Pedigree*@           
                  <tbody>
                      <tr>
                        <td ROWSPAN="8"> @Html.DisplayFor(model => model.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Father.Reg)
                        </td>                
                        <td ROWSPAN="4"> @Html.DisplayFor(model => model.Father.Litter.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Father.Litter.Father.Reg)
                        </td>
                        <td ROWSPAN="2"> @Html.DisplayFor(model => model.Father.Litter.Father.Litter.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Father.Litter.Father.Litter.Father.Reg)
                         </td>                
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Father.Litter.Father.Litter.Father.Name)
                        </td>
                        <tr>
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Father.Litter.Father.Litter.Mother.Name)</td>
                        <tr>
                        <td ROWSPAN="2">@Html.DisplayFor(model => model.Father.Litter.Father.Litter.Mother.Name)
                        <br>            @Html.DisplayFor(model => model.Father.Litter.Father.Litter.Mother.Reg) 
                        </td>
                        <td  style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Father.Litter.Mother.Litter.Father.Name)</td>
                        </tr>
                        <tr>
                        <td  style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Father.Litter.Mother.Litter.Mother.Name)</td>
                        </tr>
                        <tr>
                        <td ROWSPAN="4"> @Html.DisplayFor(model => model.Father.Litter.Mother.Name)
                         <br>            @Html.DisplayFor(model => model.Father.Litter.Mother.Reg)
                        </td>
                        <td ROWSPAN="2"> @Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Father.Reg)
                        </td>
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Father.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                        <td  style="height:20px;table-layout:fixed"> @Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Father.Litter.Mother.Name)</td>
                    </tr>
                    <tr>
                        <td ROWSPAN="2">@Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Mother.Name)
                        <br>            @Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Mother.Reg)
                        </td>
                        <td  style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Mother.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                        <td  style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Father.Litter.Mother.Litter.Mother.Litter.Mother.Name)</td>
                    </tr>
                    

                     @*Mothers Pedigree*@    
                    <tr>
                        <td ROWSPAN="8"> @Html.DisplayFor(model => model.Mother.Name)
                        <br>             @Html.DisplayFor(model => model.Mother.Reg)
                        </td>
                        <td ROWSPAN="4"> @Html.DisplayFor(model => model.Mother.Litter.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Mother.Litter.Father.Reg)
                        </td>

                        <td ROWSPAN="2"> @Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Father.Name)
                        <br>             @Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Father.Reg)
                        </td>
                       <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Father.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Father.Litter.Mother.Name)</td>
                    </tr>
                    <tr>
                        <td ROWSPAN="2"> @Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Mother.Name)
                        <br>             @Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Mother.Reg)
                        </td>
                        <td style="height:20px;table-layout:fixed"> @Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Mother.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                         <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Mother.Litter.Father.Litter.Mother.Litter.Mother.Name)</td>
                    </tr>

                    <tr>
                        <td ROWSPAN="4">@Html.DisplayFor(model => model.Mother.Litter.Mother.Name)
                        <br>            @Html.DisplayFor(model => model.Mother.Litter.Mother.Reg)
                        </td>
                        <td ROWSPAN="2">@Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Father.Name)
                         <br>           @Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Father.Reg)
                        </td>
                        <td style="height:20px;table-layout:fixed"> @Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Father.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Father.Litter.Mother.Name)</td>
                    </tr>
                    <tr>
                         <td ROWSPAN="2">@Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Mother.Name)
                          <br>           @Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Mother.Reg)
                         </td>
                         <td style="height:20px;table-layout:fixed"> @Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Mother.Litter.Father.Name)</td>
                    </tr>
                    <tr>
                        <td style="height:20px;table-layout:fixed">@Html.DisplayFor(model => model.Mother.Litter.Mother.Litter.Mother.Litter.Mother.Name)</td>
                    </tr>
                   </tbody>
                 </table>
                                   	
      </div>
    </div>

<script type="text/javascript" src="../scripts/hogan-2.0.0.js"></script>

<script type="text/javascript">
  
    $(document).ready(function () {
        $("#typeaheadFather").typeahead({
            name: "Father", 
            remote: 'Registerdog/FetchFathers?q=%QUERY',
            limit: 3,
            valueKey: "Reg",
            template: ['<p class="repo-reg">{{Reg}}</p>', '<p class="repo-name">{{Name}}</p>',
            ].join(''),
            engine: Hogan
        }).on("typeahead:selected typeahead:autocompleted",
            function (e, datum) {
                $('#returnFatherId').val(datum.Id);
                $('#fatherName').val(datum.Name);

            }
        );
    });

    $(document).ready(function () {
        $("#typeaheadMother").typeahead({
            name: "Mother",
            remote: 'Registerdog/FetchMothers?q=%QUERY',
            limit: 3,
            valueKey: "Reg",
            template: ['<p class="repo-reg">{{Reg}}</p>', '<p class="repo-name">{{Name}}</p>',].join(''),
            engine: Hogan
        }).on("typeahead:selected typeahead:autocompleted",
            function (e, datum) {
                $('#returnMotherId').val(datum.Id);
                $('#motherName').val(datum.Name);

            }
        );
    });


    //MODAL for Inbreeding info
    $(function () {
        $.ajaxSetup({ cache: false });
        $('#info').click(function () {                 // Open the Modal
            $('#dialogContent').load(this.href, function () {
                $('#dialogDiv').modal({
                    backdrop: 'static',
                    keyboard: true
                }, 'show');
                bindForm(this);
            });
            return false;
        });
    });

    function bindForm(dialog) {
        $('form', dialog).submit(function () {
            $.ajax({
                url: this.action,
                type: this.method,
                data: $(this).serialize(),
                success: function (result) {
                    if (result.success) {           // if data was saved successfully we close the modal.
                        $('#dialogDiv').modal('hide');
                        //Refresh: location.reload();

                    } else {
                        $('#dialogContent').html(result);
                        bindForm();
                    }
                }
            });
            return false;
        });
    }


</script>
<script>
    (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-45948404-1', '85.220.79.130'); ga('send', 'pageview');

</script>